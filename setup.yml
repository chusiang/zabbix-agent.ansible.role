#!/usr/bin/env ansible-playbook
# vim:ft=ansible:

---
- name: play 'zabbix-agent.ansible.role/setup.yml'
  hosts: all

  #roles:
  #  - chusiang.vim-and-vi-mode

  vars_files:
    - defaults/main.yml

  tasks:
    - name: include main task
      include: tasks/main.yml

    - name: restart zabbix-agent on ubuntu
      service: name=zabbix-agent state=restarted
      when: ansible_distribution|lower == "ubuntu"

    - name: restart zabbix-agent on debian
      service: name=zabbix-agent state=restarted
      when: ansible_distribution|lower == "debian"

    - name: restart zabbix-agent on centos
      service: name=zabbix-agent state=restarted
      when: ansible_distribution|lower == "centos"

    - name: check process
      shell: ps -A | grep zabbix-agent
      register: zabbix_agent_process

    - name: print process
      debug:
        msg: "{{ zabbix_agent_process.stdout_lines }}"

  handlers:
    - name: restart zabbix-agent
      include: handlers/main.yml

